<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Intervals.icu Wellness Upload</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 400px; margin: 50px auto; padding: 0px; }
    input { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; font-size: 12px; }
    button { background: #007bff; color: white; padding: 12px; border: none; width: 100%; cursor: pointer; }
    button:hover { background: #0056b3; }
    #status { margin-top: 20px; padding: 10px; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    label { font-weight: bold; font-size: 12px; }
  </style>
</head>
<body>
  <h2>Upload Wellness to Intervals</h1>

  <form id="wellnessForm">
    <label for="weightInput">Weight (kg):</label>
    <input type="number" id="weightInput" step="0.1" min="60" >

    <label for="sleepInput">Sleep Duration (e.g. 7h30m):</label>
    <input type="text" id="sleepInput" >

    <label for="readinessInput">Daily Readiness:</label>
    <input type="number" id="readinessInput" step="1" min="0" >

    <label for="respirationInput">Breathing Rate:</label>
    <input type="number" id="respirationInput" step="1" min="0" >

    <label for="spo2Input">Blood Oxygen (%):</label>
    <input type="number" id="spo2Input" step="1" min="0" maz="100" >

    <label for="rhrInput">Resting Heart Rate (bpm):</label>
    <input type="number" id="rhrInput" min="30" max="100" step="1" >

    <label for="hrvInput">Heart Rate Variability (ms):</label>
    <input type="number" id="hrvInput" step="1" min="0" >

    <label for="vo2maxInput">Cardio Fitness Score:</label>
    <input type="number" id="vo2maxInput" step="1" min="0" >

    <button type="submit">Submit</button>
  </form>

  <div id="status"></div>

  <script>
    // Replace with your actual values from intervals.icu
 //   const ATHLETE_ID = 'i174212';  // e.g., '123456'
 //   const API_KEY = '3bjz27ydq97vjwmrc7f8u12oo';  // From Settings > Developer Settings

function durationToSeconds(str) {
  const hoursMatch = str.match(/(\d+)h/i);
  const minutesMatch = str.match(/(\d+)m/i);
  const hours = hoursMatch ? parseInt(hoursMatch[1], 10) : 0;
  const minutes = minutesMatch ? parseInt(minutesMatch[1], 10) : 0;
  return hours * 3600 + minutes * 60;
}
 

    async function uploadWellness(weight, sleep, readiness, respiration, spo2, rhr, hrv, vo2max) {
      const today = new Date();
      today.setDate(today.getDate() + 1);     // Adds one day

      today.setHours(0, 0, 0, 0);
      const dateStr = today.toISOString().split('T')[0];

      

      const data = {
        date: dateStr,
        weight: parseFloat(weight) || null,
        sleepSecs: parseInt(durationToSeconds(sleep)) || null,  //hours & mins to seconds
        readiness: parseInt(readiness) || null,
        respiration: parseInt(respiration) || null,
        spO2: parseInt(spo2) || null,
        restingHR: parseInt(rhr) || null,
        hrv: parseInt(hrv * 3) || null,  //suggested multiplier
        vo2max: parseInt(vo2max) || null
      };

      const url = `https://update-intervals.vercel.app/api/wellness`;

      try {

        // In uploadWellness function, update fetch:
//const auth = btoa('API_KEY:' + API_KEY);  // username: "API_KEY", password: your_key

const response = await fetch(url, {
  method: 'POST',
  headers: {
//    'Authorization': `Basic ${auth}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(data)
});


        if (!response.ok) {
          const errText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errText}`);
        }

        return await response.json();
      } catch (error) {
        throw new Error(`Upload failed: ${error.message}`);
      }
    }

    document.getElementById('wellnessForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const statusEl = document.getElementById('status');
      statusEl.textContent = 'Uploading...';
      statusEl.className = '';

 //     if (ATHLETE_ID === 'your_athlete_id_here' || API_KEY === 'your_api_key_here') {
 //       statusEl.textContent = 'Please set your ATHLETE_ID and API_KEY in the script.';
  //      statusEl.className = 'error';
 //       return;
 //     }

      try {
        const weight = document.getElementById('weightInput').value;
        const sleep = document.getElementById('sleepInput').value;
        const readiness = document.getElementById('readinessInput').value;
        const respiration = document.getElementById('respirationInput').value;
        const spo2 = document.getElementById('spo2Input').value;
        const rhr = document.getElementById('rhrInput').value;
        const hrv = document.getElementById('hrvInput').value;
        const vo2max = document.getElementById('vo2maxInput').value;

        const result = await uploadWellness(weight, sleep, readiness, respiration, spo2, rhr, hrv, vo2max);
        statusEl.textContent = 'Success! Data uploaded for ' + new Date().toDateString();
        statusEl.className = 'success';
      } catch (error) {
        statusEl.textContent = error.message;
        statusEl.className = 'error';
      }
    });
  </script>
</body>
</html>

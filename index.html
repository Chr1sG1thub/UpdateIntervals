<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Intervals.icu Wellness Upload</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 400px; margin: 50px auto; padding: 20px; }
    input { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
    button { background: #007bff; color: white; padding: 12px; border: none; width: 100%; cursor: pointer; }
    button:hover { background: #0056b3; }
    #status { margin-top: 20px; padding: 10px; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    label { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Upload Wellness to Intervals.icu</h1>
  <p>Enter values for today and click Submit. Replace placeholders with your athlete ID and API key.</p>

  <form id="wellnessForm">
    <label for="weightInput">Weight (kg):</label>
    <input type="number" id="weightInput" step="0.1" min="60" placeholder="e.g., 70.2">

    <label for="sleepInput">Sleep Duration (hours):</label>
    <input type="number" id="sleepInput" step="0.1" min="0" max="24" placeholder="e.g., 7.5">

    <label for="respirationInput">Breathing Rate:</label>
    <input type="number" id="respirationInput" step="1" min="0" placeholder="e.g., 15">

    <label for="spo2Input">Blood Oxygen (%):</label>
    <input type="number" id="spo2Input" step="1" min="0" maz="100" placeholder="e.g., 55">

    <label for="rhrInput">Resting Heart Rate (bpm):</label>
    <input type="number" id="rhrInput" min="30" max="100" step="1" placeholder="e.g., 55">

    <label for="hrvInput">Heart Rate Variability (ms):</label>
    <input type="number" id="hrvInput" step="1" min="0" placeholder="e.g., 15">

    <label for="vo2maxInput">Cardio Fitness Score:</label>
    <input type="number" id="vo2maxInput" step="1" min="0" placeholder="e.g., 53">

    <button type="submit">Submit to Intervals.icu</button>
  </form>

  <div id="status"></div>

  <script>
    // Replace with your actual values from intervals.icu
    const ATHLETE_ID = 'i174212';  // e.g., '123456'
    const API_KEY = '3bjz27ydq97vjwmrc7f8u12oo';  // From Settings > Developer Settings

    async function uploadWellness(weight, sleep, respiration, spo2, rhr, hrv, vo2max) {
      const today = new Date();
      today.setDate(today.getDate() + 1);     // Adds one day

      today.setHours(0, 0, 0, 0);
      const dateStr = today.toISOString().split('T')[0];

      const data = {
        id: dateStr,
        weight: parseFloat(weight) || null,
        sleepSecs: parseFloat(sleep*3600) || null,
        respiration: parseInt(respiration) || null,
        spO2: parseInt(spo2) || null,
        restingHR: parseInt(rhr) || null,
        hrv: parseInt(hrv) || null,
        vo2max: parseInt(vo2max) || null
      };

      const url = `https://intervals.icu/api/v1/athlete/${ATHLETE_ID}/wellness/${dateStr}`;

      try {

        // In uploadWellness function, update fetch:
const auth = btoa('API_KEY:' + API_KEY);  // username: "API_KEY", password: your_key

const response = await fetch(url, {
  method: 'PUT',
  headers: {
    'Authorization': `Basic ${auth}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(data)
});


        if (!response.ok) {
          const errText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errText}`);
        }

        return await response.json();
      } catch (error) {
        throw new Error(`Upload failed: ${error.message}`);
      }
    }

    document.getElementById('wellnessForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const statusEl = document.getElementById('status');
      statusEl.textContent = 'Uploading...';
      statusEl.className = '';

      if (ATHLETE_ID === 'your_athlete_id_here' || API_KEY === 'your_api_key_here') {
        statusEl.textContent = 'Please set your ATHLETE_ID and API_KEY in the script.';
        statusEl.className = 'error';
        return;
      }

      try {
        const weight = document.getElementById('weightInput').value;
        const sleep = document.getElementById('sleepInput').value;
        const respiration = document.getElementById('respirationInput').value;
        const spo2 = document.getElementById('spo2Input').value;
        const rhr = document.getElementById('rhrInput').value;
        const hrv = document.getElementById('hrvInput').value;
        const vo2max = document.getElementById('vo2maxInput').value;

        const result = await uploadWellness(weight, sleep, respiration, spo2, rhr, hrv, vo2max);
        statusEl.textContent = 'Success! Data uploaded for ' + new Date().toDateString();
        statusEl.className = 'success';
      } catch (error) {
        statusEl.textContent = error.message;
        statusEl.className = 'error';
      }
    });
  </script>
</body>
</html>
